/****************************************
Action! v0.6.0 Antonio Banderas 
https://github.com/designfrontier/Action 
****************************************/
!function(){"use strict";var e={eventMe:function(t){var n=t,o=[];return n.emitterId=Math.ceil(1e4*Math.random()),n.eventStore={},n.emit=function(t,n,o){var r=this,a="undefined"!=typeof o&&o?r.eventStore[t]:e.eventStore[t];"undefined"!=typeof a&&a.forEach(function(e){"undefined"!=typeof e.scope?e.call.apply(e.scope,[n,r.emitterId]):e.call(n,r.emitterId),e.once&&r.silence({eventName:t,scope:e.scope,handler:e.call,once:e.once,local:e.local})})},n.emitLocal=function(e,t){var n=this;n.emit(e,t,!0)},n.listen=function(t,n,r,a,i){var c,s,l=this,f=!0,u=t,d=n,p=r,y=i,h=a;"object"==typeof t&&(u=t.eventName,d=t.handler,p=t.scope,h="undefined"!=typeof t.once?t.once:!1,y="undefined"!=typeof t.local?t.local:!1),c="undefined"!=typeof y&&y?l.eventStore[u]:e.eventStore[u],s="undefined"!=typeof y&&y?l:e,"undefined"!=typeof c?(c.some(function(e){return e.call.toString()===d.toString()&&e.once===!1?(f=!1,!0):void 0}),f&&"undefined"!=typeof p?c.push({once:h,call:d,scope:p,local:y}):f&&c.push({once:h,call:d,local:y})):(s.eventStore[u]=[],s.eventStore[u].push("undefined"!=typeof p?{once:h,call:d,scope:p,local:y}:{once:h,call:d,local:y})),o.push({eventName:u,once:h,call:d,scope:p,local:y})},n.listenLocal=function(e,t,n,o){var r=this;"object"==typeof e?(e.local=!0,r.listen(e)):r.listen({eventName:e,handler:t,scope:n,once:o,local:!0})},n.listenOnce=function(e,t,n){var o=this;"object"==typeof e?(e.once=!0,o.listen(e)):o.listen({eventName:e,handler:t,scope:n,once:!0})},n.listenOnceLocal=function(e,t,n){var o=this;"object"==typeof e?(e.local=!0,e.once=!0,o.listen(e)):o.listen({eventName:e,handler:t,scope:n,local:!0,once:!0})},n.silence=function(t,n,o,r,a){var i,c=this,s=t,l=n,f=o,u=a,d=r;"object"==typeof t&&(s=t.eventName,l=t.handler,f=t.once,u=t.scope,d=t.local),i="undefined"!=typeof d&&d?c:e,"undefined"!=typeof i.eventStore[s]&&(i.eventStore[s]="undefined"!=typeof l?i.eventStore[s].filter(function(e){var t=!(l.toString()!==e.call.toString());return"undefined"!=typeof u?(t=!(!t||!u),"boolean"==typeof f&&(t=!(!t||f!==e.once))):"boolean"==typeof f&&(t=!(!t||e.once!==f)),!t}):[])},n.silenceLocal=function(e,t,n,o){var r=this;"object"==typeof e?(e.local=!0,r.silence(e)):r.silence({eventName:e,handler:t,once:n,scope:o,local:!0})},n.requiredEvent=function(e,t,n,o){var r=this,a=function(e,t){var n=e,o=t;return function(){var e,t=!0;if("undefined"!=typeof o[n]){o[n]=!0;for(e in o)t=t&&o[e];t&&(!r._triggeredStateReady||r._fireMultiple)&&(setTimeout(r.stateReady.apply(r),100),r._triggeredStateReady=!0)}}};r._fireMultiple="undefined"!=typeof o?o:!1,"undefined"==typeof r.stateEvents&&(r.stateEvents={}),"undefined"==typeof r._triggeredStateReady&&(r._triggeredStateReady=!1),r.stateEvents[e]=!1,r.listen(e,t,n),r.listen(e,a(e,r.stateEvents),r)},n.tearDown=function(){var t=this;o.forEach(function(n){t.silence(n),e.silence(n)})},"undefined"==typeof n.stateReady&&(n.stateReady=function(){console.log("ready!")}),n.listen("system:trace",function(e){var t=this;t.emitterId===e&&t.emit("system:addTraced",t)},n),"function"==typeof n.init&&n.init.apply(n),n},modelMe:function(t){var n=this,o=n.compose(n.eventMe,n.ajaxMe),r={},a=[];return o.super={},o.get=function(e){return r[e]},o.set=function(t,n){var o,a=this;if("object"==typeof t)for(o in t)t.hasOwnProperty(o)&&("tearDown"!==o&&"fetch"!==o&&"save"!==o&&"function"!=typeof t[o]?("object"==typeof n?(r[t]=Array.isArray(t[o])?[]:{},e.clone(r[t],t[o])):r[o]=t[o],a.emitLocal("attribute:changed",o)):("function"!=typeof a[o]||a.super[o]||(a.super[o]=a[o].bind(a)),a[o]=t[o]));else"tearDown"!==t&&"fetch"!==t&&"save"!==t?("object"==typeof n?(r[t]=Array.isArray(n)?[]:{},e.clone(r[t],n)):r[t]=n,a.emitLocal("attribute:changed",t)):("function"==typeof a[t]&&(a.super[t]=a[t].bind(a)),a[t]=n)},o.flatten=function(){return r},o.toJSON=function(){return JSON.stringify(r)},o.fetch=function(t,n,o,r){var a=this,i=a.url,c=a.get("cacheLocal")&&e.useLocalCache&&!r;"undefined"!=typeof i?c?window.localforage.getItem(window.btoa(a.url),function(e){null===e?a.ajaxGet(t,function(e){var t=e,n=a.url;window.localforage.setItem(window.btoa(n),t,function(){})}):a.emit(a.get("dataEvent"),e)}):a.ajaxGet(t,n):(a.emit("global:error",new e.Error("http","No URL defined",a)),"function"==typeof o&&o.apply(a))},o.save=function(){var t=this,n=t.url,o=t.get("id"),r="undefined"==typeof o?"post":"put",a=new XMLHttpRequest;"undefined"!=typeof n?(a.onload=function(){200===this.status||302===this.status?(t.clearChanges(),t.set(data),t.emit(t.get("dataEvent"),data)):(500===this.status||400===this.status)&&t.emit("global:error",new e.Error("http","Error in request",t))},a.submittedData=t.flatten(),a.open(r,n,!0),a.send()):e.emit("global:error",new e.Error("http","No URL defined",t))},o.clearChanges=function(){a=[]},o.getChanges=function(){return a},o.clear=function(){r={}},o.super.tearDownEvents=o.tearDown,o.tearDown=function(){var e=this;e.super.tearDownEvents.apply(o),e.clear(),Object.getOwnPropertyNames(o).forEach(function(e){o[e]=void 0})},"undefined"!=typeof t.data&&(o.set(t.data),delete t.data),Object.getOwnPropertyNames(t).forEach(function(e){"undefined"!=typeof o[e]&&(o.super[e]=o[e]),o[e]=t[e]}),o.listenLocal("attribute:changed",function(e){a.push(e)},o),o.listen(o.get("requestEvent"),function(){this.fetch()},o),"function"==typeof o.init&&o.init.apply(o),o},ajaxMe:function(t){var n=t||{};return n.ajaxGet=function(t,n,o){var r=this,a=o||r.url,i=new XMLHttpRequest;i.onload=function(){var o=JSON.parse(this.responseText);this.status.match(/^[23][0-9][0-9]$/)?(r.emit(r.get("dataEvent"),o),"string"==typeof t?r.set(t,o):r.set(o),"function"==typeof n&&n.apply(r,[o])):this.status.match(/^[4][0-9][0-9]$/)||this.status.match(/^[5][0-9][0-9]$/)&&r.emit("global:error",new e.Error("http","Error in request",r))},i.onerror=function(t,n,o){r.emit("global:error",new e.Error("http","Error in request type: "+n,r,o))},i.open("get",a,!0),i.send()},n},viewMe:function(e){var t=this,n=t.eventMe(e);if("undefined"==typeof n.render)throw"render is required for a view";return n.stateReady=function(){n.render.apply(n)},n.requiredEvent("data:set:"+n.dataID,function(e){this.viewData=e},n),n.requiredEvent("template:set:"+n.templateID,function(e){this.template=e},n),"undefined"==typeof n.destroy&&(n.destroy=function(){}),n.listen("state:change",function(e){var t=this;(e===t.stateEvent||e.replace("/","")===t.stateEvent)&&(t.emit("template:get",t.templateID),t.emit("data:get:"+t.dataID))},n),n},routeMe:function(){var e=this,t=e.eventMe({}),n=function(){var e=(document.querySelectorAll("a"),document);e.addEventListener("click",function(e){var n,o=e.toElement;if("a"===o.tagName.toLowerCase()){if(n=o.attributes.href.textContent,n.match(/http:/))return{};t.emit("state:change",n),e.preventDefault()}})};return n(),{}},Error:function(e,t,n,o){return{type:e,message:t,createdBy:n,errorObject:o}},clone:function(t,n){var o=t,r=n;return"undefined"==typeof r&&(r=t,o={}),Object.getOwnPropertyNames(o).forEach(function(e){"length"!==e&&(o[e]=void 0)}),Object.getOwnPropertyNames(r).forEach(function(t){"object"==typeof r[t]?(o[t]=Array.isArray(r[t])?[]:{},e.clone(o[t],r[t])):o[t]=r[t]}),o},compose:function(){var e={},t=0,n={},o=this;for(t=0;t<arguments.length;t++)"object"!=typeof arguments[t]||Array.isArray(arguments[t])?"function"==typeof arguments[t]&&arguments[t].call(e,e):(n=arguments[t],Object.getOwnPropertyNames(n).forEach(function(t){e[t]="object"==typeof n[t]?o.clone(n[t]):n[t]}));return e},eventStore:{}};e=e.eventMe(e),e.listen("template:get",function(t){e.emit("template:set:"+t,e.templates[t])}),e.listen("system:addTraced",function(e){console.log("TRACED OBJECT!!!"),console.log(e)}),e.listen("global:error",function(e){console.group("An Error occured in an object with emitterid: "+e.createdBy.emitterId),console.log("It was a "+e.type+"error."),"string"==typeof e.errorObject?(console.log("It says: "+e.errorObject),console.log("and: "+e.message)):console.log("It says: "+e.message),console.log("The Whole Enchilada (object that caused this mess):"),console.dir(e.createdBy),"function"==typeof e.createdBy.flatten&&(console.log("Just the Lettuce (attributes):"),console.dir(e.createdBy.flatten())),"object"==typeof e.errorObject&&(console.log("Oh look an Error Object!:"),console.dir(e.errorObject)),console.groupEnd()}),"undefined"!=typeof module?module.exports=e:window.action=e}();